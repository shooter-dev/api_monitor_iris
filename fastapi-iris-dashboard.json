{
  "dashboard": {
    "id": null,
    "uid": "fastapi-iris-dashboard",
    "title": "FastAPI + Iris Model Metrics",
    "schemaVersion": 30,
    "version": 1,
    "refresh": "5s",
    "panels": [

      {
        "type": "stat",
        "title": "Total HTTP Requests",
        "gridPos": {"x": 0, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m]))",
            "legendFormat": "requests/sec"
          }
        ]
      },

      {
        "type": "stat",
        "title": "HTTP Error Rate (4xx + 5xx)",
        "gridPos": {"x": 6, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status=~\"4..|5..\"}[5m]))",
            "legendFormat": "errors/sec"
          }
        ]
      },

      {
        "type": "stat",
        "title": "Requests In Progress",
        "gridPos": {"x": 12, "y": 0, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "sum(http_requests_inprogress)",
            "legendFormat": "in-progress"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Request Rate by Endpoint",
        "gridPos": {"x": 0, "y": 4, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "sum by (handler) (rate(http_requests_total[5m]))",
            "legendFormat": "{{handler}}"
          }
        ]
      },

      {
        "type": "graph",
        "title": "p95 Latency (All Endpoints)",
        "gridPos": {"x": 12, "y": 4, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_highr_seconds_bucket[5m])) by (le))",
            "legendFormat": "p95 latency"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Latency by Endpoint (p95)",
        "gridPos": {"x": 0, "y": 10, "w": 24, "h": 6},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, handler))",
            "legendFormat": "{{handler}} p95"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Response Size by Endpoint",
        "gridPos": {"x": 0, "y": 16, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "sum by (handler) (rate(http_response_size_bytes_sum[5m]))",
            "legendFormat": "{{handler}}"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Request Size by Endpoint",
        "gridPos": {"x": 12, "y": 16, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "sum by (handler) (rate(http_request_size_bytes_sum[5m]))",
            "legendFormat": "{{handler}}"
          }
        ]
      },

      {
        "type": "stat",
        "title": "Iris Predictions Total",
        "gridPos": {"x": 0, "y": 22, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "sum(iris_prediction_requests_total)",
            "legendFormat": "predictions"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Iris Predictions by Class",
        "gridPos": {"x": 6, "y": 22, "w": 18, "h": 6},
        "targets": [
          {
            "expr": "sum by (prediction_class) (rate(iris_prediction_requests_total[5m]))",
            "legendFormat": "{{prediction_class}}"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Iris Prediction Latency (p95)",
        "gridPos": {"x": 0, "y": 28, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(iris_prediction_latency_seconds_bucket[5m])) by (le))",
            "legendFormat": "p95"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Iris Prediction Confidence",
        "gridPos": {"x": 12, "y": 28, "w": 12, "h": 6},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(iris_prediction_confidence_bucket[5m])) by (le, prediction_class))",
            "legendFormat": "{{prediction_class}}"
          }
        ]
      },

      {
        "type": "stat",
        "title": "Iris Active Requests",
        "gridPos": {"x": 0, "y": 34, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "iris_active_requests",
            "legendFormat": "active"
          }
        ]
      },

      {
        "type": "graph",
        "title": "CPU Usage (seconds)",
        "gridPos": {"x": 6, "y": 34, "w": 9, "h": 6},
        "targets": [
          {
            "expr": "rate(process_cpu_seconds_total[5m])",
            "legendFormat": "cpu"
          }
        ]
      },

      {
        "type": "graph",
        "title": "Memory Usage",
        "gridPos": {"x": 15, "y": 34, "w": 9, "h": 6},
        "targets": [
          {
            "expr": "process_resident_memory_bytes",
            "legendFormat": "rss memory"
          }
        ]
      }
    ]
  },
  "overwrite": true
}
